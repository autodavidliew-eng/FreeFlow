openapi: 3.0.3
info:
  title: FreeFlow API Gateway
  description: |
    API Gateway for FreeFlow - a modern workflow and productivity platform.

    All endpoints require authentication via Bearer token in Authorization header
    unless otherwise specified.
  version: 1.0.0
  contact:
    name: FreeFlow Team
    email: api@freeflow.dev
  license:
    name: MIT

servers:
  - url: http://localhost:4000/api/v1
    description: Local development
  - url: https://api.freeflow.dev/v1
    description: Production

tags:
  - name: Authentication
    description: User authentication and authorization
  - name: User
    description: User profile management
  - name: Dashboard
    description: Dashboard and widget management
  - name: Notifications
    description: Alarms and notifications
  - name: Tasks
    description: Task and inbox management
  - name: MiniApps
    description: Mini-application ecosystem

security:
  - bearerAuth: []

paths:
  # User Profile Endpoints
  /me:
    get:
      tags:
        - User
      summary: Get current user profile
      description: Retrieve the authenticated user's profile information
      operationId: getCurrentUser
      responses:
        '200':
          description: User profile retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
              example:
                id: "usr_1a2b3c4d"
                email: "john.doe@example.com"
                name: "John Doe"
                role: "user"
                avatar: "https://cdn.freeflow.dev/avatars/usr_1a2b3c4d.jpg"
                preferences:
                  theme: "dark"
                  notifications: true
                  timezone: "America/New_York"
                createdAt: "2026-01-15T10:30:00Z"
                lastLoginAt: "2026-02-07T08:15:00Z"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

    patch:
      tags:
        - User
      summary: Update current user profile
      description: Update the authenticated user's profile information
      operationId: updateCurrentUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserUpdateRequest'
            example:
              name: "John Doe Jr."
              preferences:
                theme: "light"
                notifications: false
      responses:
        '200':
          description: User profile updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  # Dashboard Endpoints
  /dashboard/layout:
    get:
      tags:
        - Dashboard
      summary: Get user's dashboard layout
      description: Retrieve the authenticated user's customized dashboard layout configuration
      operationId: getDashboardLayout
      responses:
        '200':
          description: Dashboard layout retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardLayout'
              example:
                id: "layout_xyz789"
                userId: "usr_1a2b3c4d"
                name: "My Dashboard"
                isDefault: true
                grid:
                  columns: 12
                  rowHeight: 100
                widgets:
                  - id: "widget_001"
                    type: "task-summary"
                    position: { x: 0, y: 0, w: 6, h: 2 }
                    config: { showCompleted: false }
                  - id: "widget_002"
                    type: "alarm-list"
                    position: { x: 6, y: 0, w: 6, h: 2 }
                    config: { maxItems: 5 }
                  - id: "widget_003"
                    type: "miniapp-launcher"
                    position: { x: 0, y: 2, w: 12, h: 1 }
                    config: { layout: "grid" }
                updatedAt: "2026-02-06T14:20:00Z"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    put:
      tags:
        - Dashboard
      summary: Update dashboard layout
      description: Update the authenticated user's dashboard layout configuration
      operationId: updateDashboardLayout
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DashboardLayoutUpdate'
            example:
              name: "Updated Dashboard"
              widgets:
                - id: "widget_001"
                  type: "task-summary"
                  position: { x: 0, y: 0, w: 8, h: 2 }
                  config: { showCompleted: true }
      responses:
        '200':
          description: Dashboard layout updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardLayout'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /dashboard/widgets:
    get:
      tags:
        - Dashboard
      summary: List available widgets
      description: Get catalog of all available dashboard widgets
      operationId: listWidgets
      parameters:
        - name: category
          in: query
          description: Filter by widget category
          schema:
            type: string
            enum: [productivity, analytics, communication, utilities]
        - name: search
          in: query
          description: Search widgets by name or description
          schema:
            type: string
      responses:
        '200':
          description: Widget catalog retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/WidgetDefinition'
                  total:
                    type: integer
              example:
                data:
                  - id: "task-summary"
                    name: "Task Summary"
                    description: "Overview of your tasks and progress"
                    category: "productivity"
                    icon: "üìã"
                    defaultSize: { w: 6, h: 2 }
                    configSchema:
                      type: object
                      properties:
                        showCompleted:
                          type: boolean
                          default: false
                  - id: "alarm-list"
                    name: "Alarm List"
                    description: "Recent alarms and notifications"
                    category: "communication"
                    icon: "üîî"
                    defaultSize: { w: 6, h: 2 }
                    configSchema:
                      type: object
                      properties:
                        maxItems:
                          type: integer
                          default: 10
                total: 2
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /dashboard/widgets/{widgetId}/data:
    get:
      tags:
        - Dashboard
      summary: Get widget data
      description: Retrieve data for a specific widget instance
      operationId: getWidgetData
      parameters:
        - name: widgetId
          in: path
          required: true
          description: Widget instance ID
          schema:
            type: string
      responses:
        '200':
          description: Widget data retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  widgetId:
                    type: string
                  data:
                    type: object
                  updatedAt:
                    type: string
                    format: date-time
              example:
                widgetId: "widget_001"
                data:
                  totalTasks: 15
                  completedTasks: 8
                  pendingTasks: 7
                  overdueTasks: 2
                  progressPercentage: 53
                updatedAt: "2026-02-07T10:30:00Z"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  # Alarm/Notification Endpoints
  /alarms:
    get:
      tags:
        - Notifications
      summary: List user alarms
      description: Retrieve all alarms for the authenticated user
      operationId: listAlarms
      parameters:
        - name: status
          in: query
          description: Filter by alarm status
          schema:
            type: string
            enum: [active, snoozed, dismissed, all]
            default: active
        - name: limit
          in: query
          description: Number of results to return
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
        - name: offset
          in: query
          description: Offset for pagination
          schema:
            type: integer
            default: 0
            minimum: 0
      responses:
        '200':
          description: Alarms retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Alarm'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
              example:
                data:
                  - id: "alarm_001"
                    title: "Deployment Failed"
                    message: "Production deployment failed at step 3"
                    severity: "high"
                    source: "ci-cd-service"
                    status: "active"
                    createdAt: "2026-02-07T09:45:00Z"
                    triggeredAt: "2026-02-07T09:45:00Z"
                  - id: "alarm_002"
                    title: "Task Deadline Approaching"
                    message: "Your task 'Update documentation' is due in 2 hours"
                    severity: "medium"
                    source: "task-service"
                    status: "active"
                    createdAt: "2026-02-07T08:00:00Z"
                    triggeredAt: "2026-02-07T08:00:00Z"
                pagination:
                  total: 2
                  limit: 20
                  offset: 0
                  hasMore: false
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

    post:
      tags:
        - Notifications
      summary: Create new alarm
      description: Create a new alarm configuration
      operationId: createAlarm
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AlarmCreateRequest'
            example:
              title: "Daily Standup Reminder"
              message: "Time for daily standup meeting"
              severity: "low"
              schedule:
                type: "daily"
                time: "09:00"
                timezone: "America/New_York"
              channels: ["in-app", "email"]
      responses:
        '201':
          description: Alarm created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Alarm'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /alarms/{alarmId}:
    patch:
      tags:
        - Notifications
      summary: Update alarm
      description: Update an existing alarm configuration or status
      operationId: updateAlarm
      parameters:
        - name: alarmId
          in: path
          required: true
          description: Alarm ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AlarmUpdateRequest'
            example:
              status: "snoozed"
              snoozeUntil: "2026-02-07T14:00:00Z"
      responses:
        '200':
          description: Alarm updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Alarm'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    delete:
      tags:
        - Notifications
      summary: Delete alarm
      description: Delete an alarm permanently
      operationId: deleteAlarm
      parameters:
        - name: alarmId
          in: path
          required: true
          description: Alarm ID
          schema:
            type: string
      responses:
        '204':
          description: Alarm deleted successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  # Task/Inbox Endpoints
  /inbox/tasks:
    get:
      tags:
        - Tasks
      summary: List inbox tasks
      description: Retrieve tasks assigned to the authenticated user
      operationId: listInboxTasks
      parameters:
        - name: status
          in: query
          description: Filter by task status
          schema:
            type: string
            enum: [todo, in_progress, completed, all]
            default: todo
        - name: priority
          in: query
          description: Filter by priority level
          schema:
            type: string
            enum: [low, medium, high, urgent]
        - name: sort
          in: query
          description: Sort order
          schema:
            type: string
            enum: [dueDate, priority, createdAt, updatedAt]
            default: dueDate
        - name: order
          in: query
          description: Sort direction
          schema:
            type: string
            enum: [asc, desc]
            default: asc
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
            minimum: 1
            maximum: 100
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
            minimum: 0
      responses:
        '200':
          description: Tasks retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Task'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
              example:
                data:
                  - id: "task_abc123"
                    title: "Review pull request #456"
                    description: "Review the authentication refactor PR"
                    status: "todo"
                    priority: "high"
                    assignee:
                      id: "usr_1a2b3c4d"
                      name: "John Doe"
                    creator:
                      id: "usr_xyz789"
                      name: "Jane Smith"
                    dueDate: "2026-02-08T17:00:00Z"
                    createdAt: "2026-02-05T10:00:00Z"
                    updatedAt: "2026-02-06T14:30:00Z"
                    tags: ["code-review", "urgent"]
                  - id: "task_def456"
                    title: "Update API documentation"
                    description: "Add examples for new endpoints"
                    status: "in_progress"
                    priority: "medium"
                    assignee:
                      id: "usr_1a2b3c4d"
                      name: "John Doe"
                    creator:
                      id: "usr_1a2b3c4d"
                      name: "John Doe"
                    dueDate: "2026-02-10T17:00:00Z"
                    createdAt: "2026-02-01T09:00:00Z"
                    updatedAt: "2026-02-07T08:15:00Z"
                    tags: ["documentation"]
                pagination:
                  total: 2
                  limit: 50
                  offset: 0
                  hasMore: false
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

    post:
      tags:
        - Tasks
      summary: Create new task
      description: Create a new task
      operationId: createTask
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TaskCreateRequest'
            example:
              title: "Implement user search feature"
              description: "Add search functionality to user management page"
              priority: "medium"
              assigneeId: "usr_xyz789"
              dueDate: "2026-02-15T17:00:00Z"
              tags: ["feature", "user-management"]
      responses:
        '201':
          description: Task created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Task'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /inbox/tasks/{taskId}:
    get:
      tags:
        - Tasks
      summary: Get task details
      description: Retrieve detailed information about a specific task
      operationId: getTask
      parameters:
        - name: taskId
          in: path
          required: true
          description: Task ID
          schema:
            type: string
      responses:
        '200':
          description: Task retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskDetails'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    patch:
      tags:
        - Tasks
      summary: Update task
      description: Update task details or status
      operationId: updateTask
      parameters:
        - name: taskId
          in: path
          required: true
          description: Task ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TaskUpdateRequest'
            example:
              status: "completed"
              priority: "medium"
      responses:
        '200':
          description: Task updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Task'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  # MiniApp Endpoints
  /miniapps:
    get:
      tags:
        - MiniApps
      summary: List available mini-apps
      description: Get catalog of available mini-applications
      operationId: listMiniApps
      parameters:
        - name: category
          in: query
          description: Filter by category
          schema:
            type: string
            enum: [productivity, communication, analytics, utilities, games]
        - name: featured
          in: query
          description: Show only featured apps
          schema:
            type: boolean
        - name: search
          in: query
          description: Search by name or description
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
            minimum: 0
      responses:
        '200':
          description: Mini-apps retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/MiniApp'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
              example:
                data:
                  - id: "miniapp_calculator"
                    name: "Calculator"
                    description: "Simple calculator for quick calculations"
                    category: "utilities"
                    icon: "üßÆ"
                    version: "1.2.0"
                    author: "FreeFlow Team"
                    rating: 4.8
                    downloads: 15000
                    featured: true
                    permissions: ["none"]
                    screenshots:
                      - "https://cdn.freeflow.dev/miniapps/calculator/screen1.png"
                  - id: "miniapp_pomodoro"
                    name: "Pomodoro Timer"
                    description: "Stay focused with pomodoro technique"
                    category: "productivity"
                    icon: "‚è±Ô∏è"
                    version: "2.0.1"
                    author: "Productivity Labs"
                    rating: 4.9
                    downloads: 25000
                    featured: true
                    permissions: ["notifications"]
                    screenshots:
                      - "https://cdn.freeflow.dev/miniapps/pomodoro/screen1.png"
                pagination:
                  total: 2
                  limit: 20
                  offset: 0
                  hasMore: false
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /miniapps/installed:
    get:
      tags:
        - MiniApps
      summary: List installed mini-apps
      description: Get list of mini-apps installed by the authenticated user
      operationId: listInstalledMiniApps
      responses:
        '200':
          description: Installed mini-apps retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/InstalledMiniApp'
              example:
                data:
                  - id: "miniapp_calculator"
                    name: "Calculator"
                    icon: "üßÆ"
                    version: "1.2.0"
                    installedAt: "2026-01-20T10:00:00Z"
                    lastUsedAt: "2026-02-06T15:30:00Z"
                    config: {}
                  - id: "miniapp_pomodoro"
                    name: "Pomodoro Timer"
                    icon: "‚è±Ô∏è"
                    version: "2.0.1"
                    installedAt: "2026-01-25T14:00:00Z"
                    lastUsedAt: "2026-02-07T09:00:00Z"
                    config:
                      workDuration: 25
                      breakDuration: 5
                      autoStart: true
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

    post:
      tags:
        - MiniApps
      summary: Install mini-app
      description: Install a mini-app for the authenticated user
      operationId: installMiniApp
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MiniAppInstallRequest'
            example:
              miniAppId: "miniapp_calculator"
      responses:
        '201':
          description: Mini-app installed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstalledMiniApp'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '409':
          description: Mini-app already installed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalError'

  /miniapps/{miniAppId}:
    get:
      tags:
        - MiniApps
      summary: Get mini-app details
      description: Retrieve detailed information about a mini-app
      operationId: getMiniApp
      parameters:
        - name: miniAppId
          in: path
          required: true
          description: Mini-app ID
          schema:
            type: string
      responses:
        '200':
          description: Mini-app details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MiniAppDetails'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    delete:
      tags:
        - MiniApps
      summary: Uninstall mini-app
      description: Uninstall a mini-app for the authenticated user
      operationId: uninstallMiniApp
      parameters:
        - name: miniAppId
          in: path
          required: true
          description: Mini-app ID
          schema:
            type: string
      responses:
        '204':
          description: Mini-app uninstalled successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /miniapps/{miniAppId}/config:
    get:
      tags:
        - MiniApps
      summary: Get mini-app configuration
      description: Retrieve user-specific configuration for an installed mini-app
      operationId: getMiniAppConfig
      parameters:
        - name: miniAppId
          in: path
          required: true
          description: Mini-app ID
          schema:
            type: string
      responses:
        '200':
          description: Configuration retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  miniAppId:
                    type: string
                  config:
                    type: object
              example:
                miniAppId: "miniapp_pomodoro"
                config:
                  workDuration: 25
                  breakDuration: 5
                  autoStart: true
                  soundEnabled: true
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    put:
      tags:
        - MiniApps
      summary: Update mini-app configuration
      description: Update user-specific configuration for an installed mini-app
      operationId: updateMiniAppConfig
      parameters:
        - name: miniAppId
          in: path
          required: true
          description: Mini-app ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                config:
                  type: object
            example:
              config:
                workDuration: 30
                breakDuration: 10
                autoStart: false
      responses:
        '200':
          description: Configuration updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  miniAppId:
                    type: string
                  config:
                    type: object
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    User:
      type: object
      properties:
        id:
          type: string
        email:
          type: string
          format: email
        name:
          type: string
        role:
          type: string
          enum: [admin, manager, user, guest]
        avatar:
          type: string
          format: uri
        preferences:
          type: object
          properties:
            theme:
              type: string
              enum: [light, dark, auto]
            notifications:
              type: boolean
            timezone:
              type: string
        createdAt:
          type: string
          format: date-time
        lastLoginAt:
          type: string
          format: date-time

    UserUpdateRequest:
      type: object
      properties:
        name:
          type: string
        avatar:
          type: string
          format: uri
        preferences:
          type: object

    DashboardLayout:
      type: object
      properties:
        id:
          type: string
        userId:
          type: string
        name:
          type: string
        isDefault:
          type: boolean
        grid:
          type: object
          properties:
            columns:
              type: integer
            rowHeight:
              type: integer
        widgets:
          type: array
          items:
            $ref: '#/components/schemas/WidgetInstance'
        updatedAt:
          type: string
          format: date-time

    DashboardLayoutUpdate:
      type: object
      properties:
        name:
          type: string
        widgets:
          type: array
          items:
            $ref: '#/components/schemas/WidgetInstance'

    WidgetInstance:
      type: object
      properties:
        id:
          type: string
        type:
          type: string
        position:
          type: object
          properties:
            x:
              type: integer
            y:
              type: integer
            w:
              type: integer
            h:
              type: integer
        config:
          type: object

    WidgetDefinition:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        category:
          type: string
        icon:
          type: string
        defaultSize:
          type: object
          properties:
            w:
              type: integer
            h:
              type: integer
        configSchema:
          type: object

    Alarm:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        message:
          type: string
        severity:
          type: string
          enum: [low, medium, high, critical]
        source:
          type: string
        status:
          type: string
          enum: [active, snoozed, dismissed]
        createdAt:
          type: string
          format: date-time
        triggeredAt:
          type: string
          format: date-time
        snoozeUntil:
          type: string
          format: date-time

    AlarmCreateRequest:
      type: object
      required:
        - title
        - message
        - severity
      properties:
        title:
          type: string
        message:
          type: string
        severity:
          type: string
          enum: [low, medium, high, critical]
        schedule:
          type: object
        channels:
          type: array
          items:
            type: string
            enum: [in-app, email, sms, push]

    AlarmUpdateRequest:
      type: object
      properties:
        status:
          type: string
          enum: [active, snoozed, dismissed]
        snoozeUntil:
          type: string
          format: date-time

    Task:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        description:
          type: string
        status:
          type: string
          enum: [todo, in_progress, completed]
        priority:
          type: string
          enum: [low, medium, high, urgent]
        assignee:
          $ref: '#/components/schemas/UserSummary'
        creator:
          $ref: '#/components/schemas/UserSummary'
        dueDate:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        tags:
          type: array
          items:
            type: string

    TaskDetails:
      allOf:
        - $ref: '#/components/schemas/Task'
        - type: object
          properties:
            comments:
              type: array
              items:
                $ref: '#/components/schemas/TaskComment'
            attachments:
              type: array
              items:
                $ref: '#/components/schemas/TaskAttachment'
            subtasks:
              type: array
              items:
                $ref: '#/components/schemas/Task'

    TaskCreateRequest:
      type: object
      required:
        - title
      properties:
        title:
          type: string
        description:
          type: string
        priority:
          type: string
          enum: [low, medium, high, urgent]
        assigneeId:
          type: string
        dueDate:
          type: string
          format: date-time
        tags:
          type: array
          items:
            type: string

    TaskUpdateRequest:
      type: object
      properties:
        title:
          type: string
        description:
          type: string
        status:
          type: string
          enum: [todo, in_progress, completed]
        priority:
          type: string
          enum: [low, medium, high, urgent]
        assigneeId:
          type: string
        dueDate:
          type: string
          format: date-time

    TaskComment:
      type: object
      properties:
        id:
          type: string
        author:
          $ref: '#/components/schemas/UserSummary'
        content:
          type: string
        createdAt:
          type: string
          format: date-time

    TaskAttachment:
      type: object
      properties:
        id:
          type: string
        filename:
          type: string
        size:
          type: integer
        url:
          type: string
          format: uri
        uploadedBy:
          $ref: '#/components/schemas/UserSummary'
        uploadedAt:
          type: string
          format: date-time

    MiniApp:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        category:
          type: string
        icon:
          type: string
        version:
          type: string
        author:
          type: string
        rating:
          type: number
          format: float
        downloads:
          type: integer
        featured:
          type: boolean
        permissions:
          type: array
          items:
            type: string
        screenshots:
          type: array
          items:
            type: string
            format: uri

    MiniAppDetails:
      allOf:
        - $ref: '#/components/schemas/MiniApp'
        - type: object
          properties:
            readme:
              type: string
            changelog:
              type: string
            reviews:
              type: array
              items:
                type: object
                properties:
                  author:
                    type: string
                  rating:
                    type: integer
                  comment:
                    type: string
                  createdAt:
                    type: string
                    format: date-time

    InstalledMiniApp:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        icon:
          type: string
        version:
          type: string
        installedAt:
          type: string
          format: date-time
        lastUsedAt:
          type: string
          format: date-time
        config:
          type: object

    MiniAppInstallRequest:
      type: object
      required:
        - miniAppId
      properties:
        miniAppId:
          type: string

    UserSummary:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        avatar:
          type: string
          format: uri

    Pagination:
      type: object
      properties:
        total:
          type: integer
        limit:
          type: integer
        offset:
          type: integer
        hasMore:
          type: boolean

    Error:
      type: object
      properties:
        error:
          type: string
        message:
          type: string
        details:
          type: object

  responses:
    BadRequest:
      description: Bad request - invalid input
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: "BAD_REQUEST"
            message: "Invalid request parameters"
            details:
              field: "email"
              issue: "Invalid email format"

    Unauthorized:
      description: Unauthorized - authentication required
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: "UNAUTHORIZED"
            message: "Authentication required"

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: "NOT_FOUND"
            message: "Resource not found"

    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: "INTERNAL_ERROR"
            message: "An unexpected error occurred"
