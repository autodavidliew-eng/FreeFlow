# ============================================================================
# FreeFlow API Gateway (NestJS) - Environment Variables
# ============================================================================
# Copy this file to .env.local and fill in the values
# NEVER commit .env.local to version control!
#
# All variables here are SERVER-SIDE ONLY (not exposed to clients)
# ============================================================================

# ----------------------------------------------------------------------------
# Application
# ----------------------------------------------------------------------------

# Environment
# Options: development | staging | production | test
NODE_ENV=development

# Server port
PORT=4000

# Server host (0.0.0.0 for Docker, localhost for local dev)
HOST=0.0.0.0

# Logging level
# Options: error | warn | info | debug
LOG_LEVEL=info

# ----------------------------------------------------------------------------
# Database (PostgreSQL)
# ----------------------------------------------------------------------------
# REQUIRED - Connection string for PostgreSQL

# Local development
DATABASE_URL=postgresql://freeflow:freeflow_dev_password@localhost:5432/freeflow

# Staging example:
# DATABASE_URL=postgresql://user:password@db.staging.freeflow.dev:5432/freeflow

# Production example:
# DATABASE_URL=postgresql://user:password@db.freeflow.dev:5432/freeflow

# Database connection pool size
DB_POOL_SIZE=10

# ----------------------------------------------------------------------------
# Redis (Optional - for caching)
# ----------------------------------------------------------------------------
# OPTIONAL - Connection string for Redis cache

# Local development
# REDIS_URL=redis://localhost:6379

# Staging example:
# REDIS_URL=redis://cache.staging.freeflow.dev:6379

# Production example:
# REDIS_URL=redis://:password@cache.freeflow.dev:6379

# ----------------------------------------------------------------------------
# MongoDB (Optional - audit logs, alarm history)
# ----------------------------------------------------------------------------

# Local development (docker-compose)
MONGODB_URI=mongodb://freeflow:freeflow_dev_password@localhost:27017/freeflow?authSource=admin

# ----------------------------------------------------------------------------
# Qdrant (Optional - vector search)
# ----------------------------------------------------------------------------

QDRANT_URL=http://localhost:6333

# ----------------------------------------------------------------------------
# JWT (JSON Web Tokens)
# ----------------------------------------------------------------------------
# REQUIRED - Secrets for signing JWT tokens

# JWT signing secret (REQUIRED)
# Generate with: openssl rand -hex 32
# MUST be at least 32 characters
# CHANGE THIS IN PRODUCTION!
JWT_SECRET=your-jwt-secret-min-32-chars-change-me-in-production

# Access token expiration
# Format: 15m, 1h, 7d (minutes, hours, days)
JWT_EXPIRES_IN=15m

# Refresh token expiration
JWT_REFRESH_EXPIRES_IN=7d

# ----------------------------------------------------------------------------
# Keycloak (OIDC JWT Validation)
# ----------------------------------------------------------------------------

# REQUIRED - Keycloak issuer URL (realm)
KEYCLOAK_ISSUER=http://localhost:8080/realms/freeflow

# REQUIRED - Expected audience/client ID (comma-separated for multiple)
KEYCLOAK_AUDIENCE=freeflow-web

# OPTIONAL - Client ID used for role extraction (defaults to KEYCLOAK_AUDIENCE)
KEYCLOAK_ID=freeflow-web

# OPTIONAL - Override JWKS URI (defaults to {KEYCLOAK_ISSUER}/protocol/openid-connect/certs)
# KEYCLOAK_JWKS_URI=http://localhost:8080/realms/freeflow/protocol/openid-connect/certs

# OPTIONAL - Clock skew tolerance in seconds
KEYCLOAK_CLOCK_TOLERANCE=30

# ----------------------------------------------------------------------------
# Session & Cookies
# ----------------------------------------------------------------------------
# REQUIRED - Secret for signing session cookies

# Session secret (REQUIRED)
# Generate with: openssl rand -hex 32
# MUST be at least 32 characters
# MUST be different from JWT_SECRET
# CHANGE THIS IN PRODUCTION!
SESSION_SECRET=your-session-secret-min-32-chars-change-me-in-production

# Cookie domain (optional, for cross-subdomain cookies)
# Dev: localhost
# Staging: .staging.freeflow.dev
# Production: .freeflow.dev
COOKIE_DOMAIN=localhost

# Use secure cookies (HTTPS only)
# Dev: false
# Staging/Production: true
COOKIE_SECURE=false

# SameSite cookie attribute
# Options: strict | lax | none
# Recommended: strict (best CSRF protection)
COOKIE_SAME_SITE=lax

# ----------------------------------------------------------------------------
# CORS (Cross-Origin Resource Sharing)
# ----------------------------------------------------------------------------

# Allowed CORS origin (frontend URL)
# Dev: http://localhost:3000
# Staging: https://staging.freeflow.dev
# Production: https://freeflow.dev
CORS_ORIGIN=http://localhost:3000

# Allow credentials (cookies) in CORS requests
CORS_CREDENTIALS=true

# ----------------------------------------------------------------------------
# Rate Limiting
# ----------------------------------------------------------------------------

# Rate limit window in seconds
RATE_LIMIT_TTL=60

# Max requests per window
RATE_LIMIT_MAX=100

# ----------------------------------------------------------------------------
# Microservices (Optional - for inter-service communication)
# ----------------------------------------------------------------------------
# OPTIONAL - URLs for internal microservices

# Auth Service
# AUTH_SERVICE_URL=http://localhost:4001

# Dashboard Service
# DASHBOARD_SERVICE_URL=http://localhost:4002

# Notification Service
# NOTIFICATION_SERVICE_URL=http://localhost:4003

# Task Service
# TASK_SERVICE_URL=http://localhost:4004

# MiniApp Service
# MINIAPP_SERVICE_URL=http://localhost:4005

# ----------------------------------------------------------------------------
# External Services (Optional)
# ----------------------------------------------------------------------------

# Sentry DSN for error tracking (optional)
# SENTRY_DSN=https://your-sentry-dsn@sentry.io/project-id

# AWS credentials (optional, for S3)
# AWS_ACCESS_KEY_ID=your-access-key
# AWS_SECRET_ACCESS_KEY=your-secret-key
# AWS_REGION=us-east-1
# AWS_S3_BUCKET=freeflow-uploads

# SendGrid API key (optional, for emails)
# SENDGRID_API_KEY=your-sendgrid-api-key

# Twilio credentials (optional, for SMS)
# TWILIO_ACCOUNT_SID=your-twilio-account-sid
# TWILIO_AUTH_TOKEN=your-twilio-auth-token
# TWILIO_PHONE_NUMBER=+1234567890

# ----------------------------------------------------------------------------
# Notes
# ----------------------------------------------------------------------------
# 1. Copy this file: cp .env.example .env.local
# 2. Fill in all REQUIRED values
# 3. Generate secure random secrets (32+ characters)
# 4. Use different secrets for each environment
# 5. NEVER commit .env.local to git
# 6. Restart server after changing variables
#
# Generate secrets:
#   openssl rand -hex 32
#   node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
